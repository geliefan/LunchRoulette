# 要件定義書

## 概要

Lunch Rouletteは、東京エリアのユーザーがリアルタイムの天気データと徒歩距離計算を組み合わせてランチスポットを発見できる低コストWebサービスです。PythonAnywhere無料プランで動作し、予算制限内で近くのレストランを見つけるためのシンプルで使いやすいインターフェースを提供します。

## 要件

### 要件1

**ユーザーストーリー:** Webサイトを訪問するユーザーとして、現在地と天気情報が自動的に検出されることで、コンテキストに基づいたパーソナライズされたレストラン推薦を受けたい。

#### 受け入れ基準

1. ユーザーがルートURLを訪問した時、システムはIPジオロケーションで検出された市区町村を表示するWebページを表示すること。
2. ページが読み込まれた時、システムは気温、天気状況、UV指数を含む今日の天気概要を表示すること。
3. ページが読み込まれた時、システムはレストラン検索を開始するための目立つ「ルーレットを回す」ボタンを表示すること。

### 要件2

**ユーザーストーリー:** ランチオプションを探すユーザーとして、ボタンをクリックしてランダムなレストラン推薦を受けることで、どこで食事するかについて決定を下したい。

#### 受け入れ基準

1. ユーザーが「ルーレットを回す」ボタンをクリックした時、システムは半径1km以内のレストランをHot Pepper Gourmet Web APIで検索すること。
2. レストランを検索する時、システムはランチ予算≤¥1,200で結果をフィルタリングすること。
3. リクエストを処理する時、システムは現在の天気データをOpenWeatherMap One Call 3.0 APIで取得すること。
4. レストランが見つかった時、システムはハーバーサイン公式を使用して徒歩距離を計算すること。
5. すべてのデータが取得された時、システムは距離情報と共にランダムに選択された1つのレストランをJSONで返すこと。

### 要件3

**ユーザーストーリー:** レストラン推薦を受けるユーザーとして、レストランの詳細情報を見ることで、訪問するかどうかを決定したい。

#### 受け入れ基準

1. レストラン推薦が返された時、フロントエンドはレストラン名を含むレストランカードを表示すること。
2. レストランカードを表示する時、システムは利用可能な場合レストランの写真を表示すること。
3. レストランの詳細を表示する時、システムはナビゲーション用のマップリンクを提供すること。
4. 距離情報を表示する時、システムは徒歩距離を表示すること。
5. レストランカードが表示された時、すべての情報は明確にフォーマットされ視覚的に魅力的であること。
6. UIデザインは現在のトレンドに合わせたモダンで使いやすいインターフェースであること。

### 要件4

**ユーザーストーリー:** 無料ホスティングプランのサービス運営者として、API呼び出しがキャッシュされレート制限されることで、無料プランの制限内に留まりサービス中断を避けたい。

#### 受け入れ基準

1. 外部API呼び出しを行う時、システムはレスポンスをSQLiteデータベースに10分間キャッシュすること。
2. キャッシュされたレスポンスが存在し10分未満の場合、システムは新しいAPI呼び出しの代わりにキャッシュされたデータを使用すること。
3. API使用量を監視する時、システムはすべての外部サービス全体で1時間あたり100回未満のAPI呼び出しを維持すること。
4. データをキャッシュする時、システムは適切なキャッシュ有効期限を可能にするためタイムスタンプを保存すること。

### 要件5

**ユーザーストーリー:** PythonAnywhere無料プランにデプロイする開発者として、アプリケーションがホスティング環境に適切に設定されることで、手動介入なしに確実に動作させたい。

#### 受け入れ基準

1. アプリケーションをデプロイする時、システムは適切に設定されたFlask WSGIファイル（例: `wsgi.py`）を含むこと。
2. 依存関係を設定する時、システムは`pip install -r requirements.txt`で正常にインストールされる`requirements.txt`ファイルを提供すること。
3. アプリケーションがデプロイされた時、PythonAnywhere API経由でCGIスタイルのリロードをサポートすること。
4. PythonAnywhere無料プランで動作する時、システムはプラットフォームのリソース制限内で動作すること。
5. アプリケーションが開始された時、指定されたPython 3.11、Flask 3.x、SQLite、バニラJavaScriptを使用すること。

### 要件6

**ユーザーストーリー:** コードベースを保守する開発者として、コードが品質基準に従い適切なドキュメントを含むことで、プロジェクトが保守可能で他の人がデプロイ可能にしたい。

#### 受け入れ基準

1. コード品質チェックを実行する時、リポジトリは`flake8`リンティングをエラーなしで通過すること。
2. プロジェクトをレビューする時、セキュアで詳細な`README.md`ファイルを含むこと。
3. READMEに従う時、PythonAnywhereデプロイメントの段階的な手順を含むこと。
4. コードベースを調査する時、Pythonのベストプラクティスに従い適切にドキュメント化されていること。
5. プロジェクトをセキュアにする時、READMEはローカル開発とテストのための明確な手順を提供すること。
6. 新人開発者が学習するため、すべてのコードに日本語のコメントを含み処理内容を理解しやすくすること。
7. ドキュメントには地理情報システム（GIS）、API統合、キャッシング戦略など、プロジェクトに関連する技術理論の概要を含むこと。