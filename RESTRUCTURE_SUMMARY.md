# プロジェクト構造整理について

## 実施内容

Lunch Rouletteプロジェクトをベストプラクティスに従って以下のように再構成しました。

## 変更点

### 1. ディレクトリ構造の標準化

#### Before（変更前）
```
lunch-roulette/
├── app.py                    # アプリケーション本体
├── *.py                      # 各種サービスファイルが散在
├── test_*.py                 # テストファイルが散在
└── static/, templates/       # 静的ファイル
```

#### After（変更後）
```
lunch-roulette/
├── src/lunch_roulette/       # メインパッケージ
│   ├── models/               # データ層
│   ├── services/             # ビジネスロジック層
│   ├── utils/                # ユーティリティ
│   └── api/                  # API層（将来の拡張用）
├── tests/                    # テスト専用ディレクトリ
│   ├── unit/                 # 単体テスト
│   └── integration/          # 統合テスト
├── docs/                     # ドキュメント
├── config/                   # 設定ファイル
└── run.py                    # エントリーポイント
```

### 2. パッケージ化

- メインアプリケーションを`src/lunch_roulette`パッケージとして構成
- 各モジュールを適切な層に分類
- 相対インポートを使用したモジュール間の依存関係の明確化

### 3. 設定管理の改善

- `config.py`モジュールを作成し、環境別設定を統合管理
- 開発/本番/テスト環境の設定を分離

### 4. ビルド・パッケージ管理の現代化

- `pyproject.toml`を作成し、モダンなPythonパッケージ管理に対応
- setuptools設定をpyproject.tomlに移行

### 6. 静的ファイルとテンプレートの統合

- `static/`と`templates/`ディレクトリを`src/lunch_roulette/`内に移動
- Flaskアプリケーションの設定でstatic_folder/template_folderパスを明示的に指定
- デプロイメント手順での静的ファイル設定パスを更新

## 利点

### 1. 保守性の向上
- コードの責務が明確に分離されている
- モジュール間の依存関係が整理されている
- 新機能追加時の影響範囲が限定される
- 静的ファイルがパッケージ内に統合されて管理が簡潔

### 2. スケーラビリティ
- レイヤー分けにより、各層を独立して拡張可能
- API層の追加準備が整っている
- マイクロサービス化への移行も容易

### 3. 開発効率の向上
- IDEでのコード補完・ナビゲーションが改善
- テストの実行・管理が簡単
- 設定変更が環境別に整理されている

### 4. デプロイメントの改善
- パッケージ化により配布が容易
- 依存関係管理が明確
- 本番環境での問題発生時の調査が簡単

## 使用方法

### 開発時の起動
```bash
# 推奨方法
python run.py

# パッケージとしての実行
python -m lunch_roulette
```

### テスト実行
```bash
# 全テスト実行
pytest

# 単体テストのみ
pytest tests/unit/

# 統合テストのみ  
pytest tests/integration/
```

### パッケージインストール
```bash
# 開発モードでインストール
pip install -e .

# 開発用依存関係も含める
pip install -e .[dev]
```

## 互換性への配慮

- 既存の`wsgi.py`は新しい構造に対応するよう更新済み
- 基本的なAPI・機能は変更なし
- 既存のデプロイメント手順は最小限の変更で動作

## 今後の改善提案

1. **API層の実装**: RESTful APIを`api/`モジュールに実装
2. **設定の外部化**: `config/`ディレクトリに環境別設定ファイルを配置  
3. **ログ管理**: 構造化ログとログローテーション機能の追加
4. **ドキュメント**: `docs/`ディレクトリにSphinx等を使用した技術文書を追加